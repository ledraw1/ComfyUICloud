{"last_node_id":68,"last_link_id":91,"nodes":[{"id":20,"type":"DetailerForEach","pos":{"0":1600,"1":770},"size":{"0":400,"1":840},"flags":{"pinned":true},"order":31,"mode":0,"inputs":[{"name":"image","type":"IMAGE","link":75,"slot_index":0},{"name":"segs","type":"SEGS","link":28},{"name":"model","type":"MODEL","link":67,"slot_index":2},{"name":"clip","type":"CLIP","link":46,"slot_index":3},{"name":"vae","type":"VAE","link":47,"slot_index":4},{"name":"positive","type":"CONDITIONING","link":60,"slot_index":5},{"name":"negative","type":"CONDITIONING","link":29,"slot_index":6},{"name":"detailer_hook","type":"DETAILER_HOOK","link":null},{"name":"scheduler_func_opt","type":"SCHEDULER_FUNC","link":null}],"outputs":[{"name":"IMAGE","type":"IMAGE","links":[80,81],"slot_index":0,"shape":3}],"properties":{"Node name for S&R":"DetailerForEach"},"widgets_values":[512,true,1024,952941207260924,"randomize",20,1,"euler","sgm_uniform",0.8,5,true,true,"",1,false,20],"color":"#3d1466","bgcolor":"#290052"},{"id":23,"type":"CLIPTextEncode","pos":{"0":770,"1":1020},"size":{"0":210,"1":130},"flags":{"collapsed":true,"pinned":true},"order":13,"mode":0,"inputs":[{"name":"clip","type":"CLIP","link":45}],"outputs":[{"name":"CONDITIONING","type":"CONDITIONING","links":[29],"shape":3}],"title":"Negative - Leave Empty","properties":{"Node name for S&R":"CLIPTextEncode"},"widgets_values":[""]},{"id":27,"type":"PreviewImage","pos":{"0":790,"1":50},"size":{"0":370,"1":410},"flags":{"pinned":true},"order":21,"mode":0,"inputs":[{"name":"images","type":"IMAGE","link":71}],"outputs":[],"properties":{"Node name for S&R":"PreviewImage"},"color":"#222","bgcolor":"#000"},{"id":28,"type":"DownloadAndLoadSAM2Model","pos":{"0":1250,"1":240},"size":{"0":320,"1":130},"flags":{"pinned":true},"order":0,"mode":0,"inputs":[],"outputs":[{"name":"sam2_model","type":"SAM2MODEL","links":[35],"slot_index":0,"shape":3}],"properties":{"Node name for S&R":"DownloadAndLoadSAM2Model"},"widgets_values":["sam2_hiera_base_plus.safetensors","single_image","cuda","bf16"],"color":"#14615b","bgcolor":"#004d47"},{"id":29,"type":"Sam2Segmentation","pos":{"0":1250,"1":430},"size":{"0":320,"1":190},"flags":{"pinned":true},"order":23,"mode":0,"inputs":[{"name":"sam2_model","type":"SAM2MODEL","link":35},{"name":"image","type":"IMAGE","link":73},{"name":"bboxes","type":"BBOX","link":37},{"name":"mask","type":"MASK","link":null},{"name":"coordinates_positive","type":"STRING","link":null,"widget":{"name":"coordinates_positive"}},{"name":"coordinates_negative","type":"STRING","link":null,"widget":{"name":"coordinates_negative"}}],"outputs":[{"name":"mask","type":"MASK","links":[40,55],"slot_index":0,"shape":3}],"properties":{"Node name for S&R":"Sam2Segmentation"},"widgets_values":[true,"","",false],"color":"#14615b","bgcolor":"#004d47"},{"id":30,"type":"Florence2toCoordinates","pos":{"0":790,"1":520},"size":{"0":320,"1":100},"flags":{"pinned":true},"order":22,"mode":0,"inputs":[{"name":"data","type":"JSON","link":38}],"outputs":[{"name":"center_coordinates","type":"STRING","links":null,"slot_index":0,"shape":3},{"name":"bboxes","type":"BBOX","links":[37],"slot_index":1,"shape":3}],"properties":{"Node name for S&R":"Florence2toCoordinates"},"widgets_values":["0",false],"color":"#222","bgcolor":"#000"},{"id":31,"type":"ImageAndMaskPreview","pos":{"0":1600,"1":240},"size":{"0":320,"1":340},"flags":{"pinned":true},"order":24,"mode":0,"inputs":[{"name":"image","type":"IMAGE","link":74},{"name":"mask","type":"MASK","link":40}],"outputs":[{"name":"composite","type":"IMAGE","links":null,"slot_index":0,"shape":3}],"properties":{"Node name for S&R":"ImageAndMaskPreview"},"widgets_values":[0.8,"100, 15, 240",false],"color":"#14615b","bgcolor":"#004d47"},{"id":32,"type":"ImpactGaussianBlurMask","pos":{"0":1250,"1":770},"size":{"0":320,"1":80},"flags":{"pinned":true},"order":28,"mode":0,"inputs":[{"name":"mask","type":"MASK","link":89}],"outputs":[{"name":"MASK","type":"MASK","links":[30,52],"slot_index":0,"shape":3}],"properties":{"Node name for S&R":"ImpactGaussianBlurMask"},"widgets_values":[10,10],"color":"#3d1466","bgcolor":"#290052"},{"id":35,"type":"UNETLoader","pos":{"0":420,"1":770},"size":{"0":320,"1":80},"flags":{"pinned":true},"order":1,"mode":0,"inputs":[],"outputs":[{"name":"MODEL","type":"MODEL","links":[76],"slot_index":0,"shape":3}],"properties":{"Node name for S&R":"UNETLoader"},"widgets_values":["Flux\\flux1-dev.sft","fp8_e4m3fn"],"color":"#1f3d14","bgcolor":"#0b2900"},{"id":36,"type":"DualCLIPLoader","pos":{"0":420,"1":910},"size":{"0":320,"1":110},"flags":{"pinned":true},"order":2,"mode":0,"inputs":[],"outputs":[{"name":"CLIP","type":"CLIP","links":[45,46,83],"slot_index":0,"shape":3}],"properties":{"Node name for S&R":"DualCLIPLoader"},"widgets_values":["t5xxl_fp16.safetensors","ViT-L-14-TEXT-detail-improved-hiT-GmP-TE-only-HF.safetensors","flux"],"color":"#1f3d14","bgcolor":"#0b2900"},{"id":37,"type":"VAELoader","pos":{"0":420,"1":1080},"size":{"0":300,"1":60},"flags":{"pinned":true},"order":3,"mode":0,"inputs":[],"outputs":[{"name":"VAE","type":"VAE","links":[47],"shape":3}],"properties":{"Node name for S&R":"VAELoader"},"widgets_values":["ae.sft"],"color":"#1f3d14","bgcolor":"#0b2900"},{"id":39,"type":"Note","pos":{"0":-10,"1":-310},"size":{"0":370,"1":240},"flags":{"pinned":true},"order":4,"mode":0,"inputs":[],"outputs":[],"title":"Florence Model Links","properties":{"text":""},"widgets_values":["Florence models go into models/LLM. You can either download them from - \n\nBase: https://huggingface.co/microsoft/Florence-2-base-ft\n\nLarge: https://huggingface.co/microsoft/Florence-2-large-ft\n\nThere are other models that can be found as well. \n\nA few people seemed to have issues with this so I swapped the Florence2ModelLoader node with DownloadAndLoadFlorenence2Model one. The loader node is to the left if you'd prefer to use that, just swap the 2 out. "],"color":"#323","bgcolor":"#535"},{"id":40,"type":"ImpactControlBridge","pos":{"0":2030,"1":1110},"size":{"0":320,"1":80},"flags":{"pinned":true},"order":33,"mode":0,"inputs":[{"name":"value","type":"IMAGE","link":80}],"outputs":[{"name":"value","type":"IMAGE","links":[51],"slot_index":0,"shape":3,"label":"IMAGE"}],"properties":{"Node name for S&R":"ImpactControlBridge"},"widgets_values":[true,"Mute"],"color":"#3d1466","bgcolor":"#290052"},{"id":44,"type":"Note","pos":{"0":390,"1":-230},"size":{"0":290,"1":160},"flags":{"pinned":true},"order":5,"mode":0,"inputs":[],"outputs":[],"title":"Instructions Florence2","properties":{"text":""},"widgets_values":["Set your Aspect Ration to match the Image in Load & Resize Image. \n\nChoose your Florence Model (see note to the left for more detail), change precision and attention to suit.,\n\nEnter the area you want to mask such as face, hair, T-Shirt etc. in the Florence2Run textbox. "],"color":"#2a363b","bgcolor":"#3f5159"},{"id":45,"type":"Note","pos":{"0":1220,"1":0},"size":{"0":370,"1":120},"flags":{"pinned":true},"order":6,"mode":0,"inputs":[],"outputs":[],"title":"SAM2 Model Links","properties":{"text":""},"widgets_values":["The node will download the model for you and place it in models/sam2\n\nIf you want to download them manually they can be found here: https://huggingface.co/Kijai/sam2-safetensors/tree/main"],"color":"#323","bgcolor":"#535"},{"id":46,"type":"Note","pos":{"0":2410,"1":710},"size":{"0":400,"1":150},"flags":{"pinned":true},"order":7,"mode":0,"inputs":[],"outputs":[],"title":"Instructions - SEGS Detailer","properties":{"text":""},"widgets_values":["I put this together to see if it would work, I haven't played with any of the SEGS Detailer settings, have a play and find out what works best.\n\nThe Control Bridge is connected to the Save Image node. If you set mode to Mute/Bypass it won't save which could be useful if you want to run this several times on one image to change multiple things. Just set it to Active when you want it to save.  "],"color":"#2a363b","bgcolor":"#3f5159"},{"id":47,"type":"Switch mask [Crystools]","pos":{"0":840,"1":1670},"size":{"0":320,"1":80},"flags":{"pinned":true},"order":25,"mode":0,"inputs":[{"name":"on_true","type":"MASK","link":55,"label":"Automatic Mask = True"},{"name":"on_false","type":"MASK","link":57,"slot_index":1,"label":"Manual Mask = False"}],"outputs":[{"name":"mask","type":"MASK","links":[85],"slot_index":0,"shape":3}],"properties":{"Node name for S&R":"Switch mask [Crystools]"},"widgets_values":[true],"color":"#611439","bgcolor":"#4d0025"},{"id":48,"type":"LoadImage","pos":{"0":840,"1":1950},"size":{"0":320,"1":310},"flags":{"pinned":false},"order":8,"mode":0,"inputs":[],"outputs":[{"name":"IMAGE","type":"IMAGE","links":[68],"slot_index":0,"shape":3},{"name":"MASK","type":"MASK","links":[57],"slot_index":1,"shape":3}],"properties":{"Node name for S&R":"LoadImage"},"widgets_values":["clipspace/clipspace-mask-1111481.png [input]","image"],"color":"#611439","bgcolor":"#4d0025"},{"id":50,"type":"Note","pos":{"0":-650,"1":-10},"size":{"0":610,"1":230},"flags":{"pinned":true},"order":9,"mode":0,"inputs":[],"outputs":[],"title":"Acknowledgements","properties":{"text":""},"widgets_values":["This idea was inspired by watching 2 videos. \n\nThe first was Grockster's video \"Flux EXTREME - Cutting-Edge Techniques for Ultimate Control\" - https://youtu.be/aZt5CL3r1lQ?si=5jAB6SDfqOUfR5Vd - Where they showed using Mask to SEGS with SEGS Detailer for Flux Inpaint. I'd already been using SEGS Detailer but with BBOX Ultralytics and I didn't even know that Mask to SEGS node existed. \n\n\nThe second was FiveBelowFiveUK's video \"Start using Promptable Masks, Segment Anything & Unlock FLUX Inpainting | Foda V10\" - https://www.youtube.com/watch?v=dO2o0YbBvmI - Where he used Florence2 and SAM2 for setting the mask for Inpaint.\n\nAfter watching both I thought can I connect Florence and SAM2 to the Mask to SEGS to do automatic masking with that and created this work flow."],"color":"#322","bgcolor":"#533"},{"id":55,"type":"ModelSamplingFlux","pos":{"0":420,"1":1200},"size":{"0":320,"1":130},"flags":{"pinned":true},"order":19,"mode":0,"inputs":[{"name":"model","type":"MODEL","link":79}],"outputs":[{"name":"MODEL","type":"MODEL","links":[67],"slot_index":0,"shape":3}],"properties":{"Node name for S&R":"ModelSamplingFlux"},"widgets_values":[1,0.5,1024,1024],"color":"#1f3d14","bgcolor":"#0b2900"},{"id":51,"type":"FluxGuidance","pos":{"0":770,"1":1080},"size":{"0":320,"1":60},"flags":{"collapsed":false},"order":20,"mode":0,"inputs":[{"name":"conditioning","type":"CONDITIONING","link":59}],"outputs":[{"name":"CONDITIONING","type":"CONDITIONING","links":[60],"slot_index":0,"shape":3}],"properties":{"Node name for S&R":"FluxGuidance"},"widgets_values":[4],"color":"#1f3d14","bgcolor":"#0b2900"},{"id":59,"type":"LoraLoaderModelOnly","pos":{"0":770,"1":1200},"size":{"0":320,"1":80},"flags":{},"order":12,"mode":0,"inputs":[{"name":"model","type":"MODEL","link":76}],"outputs":[{"name":"MODEL","type":"MODEL","links":[78],"slot_index":0,"shape":3}],"properties":{"Node name for S&R":"LoraLoaderModelOnly"},"widgets_values":["04. Flux\\Detailer2K.safetensors",1],"color":"#1f3d14","bgcolor":"#0b2900"},{"id":60,"type":"LoraLoaderModelOnly","pos":{"0":770,"1":1340},"size":{"0":320,"1":80},"flags":{},"order":16,"mode":0,"inputs":[{"name":"model","type":"MODEL","link":78}],"outputs":[{"name":"MODEL","type":"MODEL","links":[79],"slot_index":0,"shape":3}],"properties":{"Node name for S&R":"LoraLoaderModelOnly"},"widgets_values":["04. Flux\\Add_More_details_Flux.safetensors",1],"color":"#1f3d14","bgcolor":"#0b2900"},{"id":41,"type":"SaveImage","pos":{"0":2030,"1":1250},"size":{"0":320,"1":270},"flags":{"collapsed":false,"pinned":false},"order":35,"mode":0,"inputs":[{"name":"images","type":"IMAGE","link":51}],"outputs":[],"properties":{"Node name for S&R":"SaveImage"},"widgets_values":["Flux\\Inpaint\\%date:yyyy-MM-dd%\\segs1_"],"color":"#3d1466","bgcolor":"#290052"},{"id":61,"type":"PreviewImage","pos":{"0":2030,"1":770},"size":{"0":320,"1":280},"flags":{},"order":34,"mode":0,"inputs":[{"name":"images","type":"IMAGE","link":81}],"outputs":[],"properties":{"Node name for S&R":"PreviewImage"},"color":"#3d1466","bgcolor":"#290052"},{"id":62,"type":"CLIPAttentionMultiply","pos":{"0":420,"1":1390},"size":{"0":320,"1":130},"flags":{},"order":14,"mode":0,"inputs":[{"name":"clip","type":"CLIP","link":83}],"outputs":[{"name":"CLIP","type":"CLIP","links":[84],"slot_index":0,"shape":3}],"properties":{"Node name for S&R":"CLIPAttentionMultiply"},"widgets_values":[1.2,1.1,0.8,1.25],"color":"#1f3d14","bgcolor":"#0b2900"},{"id":43,"type":"PreviewImage","pos":{"0":1240,"1":1380},"size":{"0":240,"1":250},"flags":{},"order":32,"mode":0,"inputs":[{"name":"images","type":"IMAGE","link":53}],"outputs":[],"properties":{"Node name for S&R":"PreviewImage"},"color":"#3d1466","bgcolor":"#290052"},{"id":42,"type":"MaskToImage","pos":{"0":1260,"1":1320},"size":{"0":210,"1":30},"flags":{"collapsed":true},"order":30,"mode":0,"inputs":[{"name":"mask","type":"MASK","link":52}],"outputs":[{"name":"IMAGE","type":"IMAGE","links":[53],"slot_index":0,"shape":3}],"properties":{"Node name for S&R":"MaskToImage"},"color":"#3d1466","bgcolor":"#290052"},{"id":21,"type":"MaskToSEGS","pos":{"0":1240,"1":1120},"size":{"0":320,"1":150},"flags":{},"order":29,"mode":0,"inputs":[{"name":"mask","type":"MASK","link":30}],"outputs":[{"name":"SEGS","type":"SEGS","links":[28],"slot_index":0,"shape":3}],"properties":{"Node name for S&R":"MaskToSEGS"},"widgets_values":[false,3,false,10,false],"color":"#3d1466","bgcolor":"#290052"},{"id":65,"type":"GrowMask","pos":{"0":1250,"1":990},"size":{"0":320,"1":80},"flags":{},"order":27,"mode":0,"inputs":[{"name":"mask","type":"MASK","link":88}],"outputs":[{"name":"MASK","type":"MASK","links":[89],"slot_index":0,"shape":3}],"properties":{"Node name for S&R":"GrowMask"},"widgets_values":[0,true]},{"id":25,"type":"Florence2Run","pos":{"0":360,"1":220},"size":{"0":400,"1":352},"flags":{"pinned":true},"order":18,"mode":0,"inputs":[{"name":"image","type":"IMAGE","link":72},{"name":"florence2_model","type":"FL2MODEL","link":91}],"outputs":[{"name":"image","type":"IMAGE","links":[71],"slot_index":0,"shape":3},{"name":"mask","type":"MASK","links":null,"shape":3},{"name":"caption","type":"STRING","links":null,"shape":3},{"name":"data","type":"JSON","links":[38],"slot_index":3,"shape":3}],"properties":{"Node name for S&R":"Florence2Run"},"widgets_values":["hair","caption_to_phrase_grounding",true,false,1024,3,true,"",42,"fixed"],"color":"#222","bgcolor":"#000"},{"id":63,"type":"InvertMask","pos":{"0":1250,"1":910},"size":{"0":210,"1":30},"flags":{},"order":26,"mode":4,"inputs":[{"name":"mask","type":"MASK","link":85}],"outputs":[{"name":"MASK","type":"MASK","links":[88],"slot_index":0,"shape":3}],"properties":{"Node name for S&R":"InvertMask"}},{"id":38,"type":"CLIPTextEncode","pos":{"0":770,"1":770},"size":{"0":400,"1":200},"flags":{"pinned":true},"order":17,"mode":0,"inputs":[{"name":"clip","type":"CLIP","link":84,"slot_index":0}],"outputs":[{"name":"CONDITIONING","type":"CONDITIONING","links":[59],"slot_index":0,"shape":3}],"properties":{"Node name for S&R":"CLIPTextEncode"},"widgets_values":["ear with gothic piercings"],"color":"#232","bgcolor":"#353"},{"id":53,"type":"LoadImage","pos":{"0":20,"1":50},"size":[320,310],"flags":{},"order":10,"mode":0,"inputs":[],"outputs":[{"name":"IMAGE","type":"IMAGE","links":[69],"slot_index":0,"shape":3},{"name":"MASK","type":"MASK","links":null,"slot_index":1,"shape":3}],"properties":{"Node name for S&R":"LoadImage"},"widgets_values":["edt1___00006_.png","image"],"color":"#222","bgcolor":"#000"},{"id":58,"type":"easy imageSwitch","pos":{"0":840,"1":1810},"size":{"0":320,"1":80},"flags":{},"order":15,"mode":0,"inputs":[{"name":"image_a","type":"IMAGE","link":69,"label":"Automatic Mask Image = True"},{"name":"image_b","type":"IMAGE","link":68,"label":"Manual Mask Image = False"}],"outputs":[{"name":"IMAGE","type":"IMAGE","links":[72,73,74,75],"slot_index":0,"shape":3}],"title":"Switch Image","properties":{"Node name for S&R":"easy imageSwitch"},"widgets_values":[true],"color":"#611439","bgcolor":"#4d0025"},{"id":68,"type":"DownloadAndLoadFlorence2Model","pos":{"0":370,"1":50},"size":[390,110],"flags":{},"order":11,"mode":0,"inputs":[{"name":"lora","type":"PEFTLORA","link":null}],"outputs":[{"name":"florence2_model","type":"FL2MODEL","links":[91],"shape":3}],"properties":{"Node name for S&R":"DownloadAndLoadFlorence2Model"},"widgets_values":["microsoft/Florence-2-base","bf16","sdpa"]}],"links":[[28,21,0,20,1,"SEGS"],[29,23,0,20,6,"CONDITIONING"],[30,32,0,21,0,"MASK"],[35,28,0,29,0,"SAM2MODEL"],[37,30,1,29,2,"BBOX"],[38,25,3,30,0,"JSON"],[40,29,0,31,1,"MASK"],[45,36,0,23,0,"CLIP"],[46,36,0,20,3,"CLIP"],[47,37,0,20,4,"VAE"],[51,40,0,41,0,"IMAGE"],[52,32,0,42,0,"MASK"],[53,42,0,43,0,"IMAGE"],[55,29,0,47,0,"MASK"],[57,48,1,47,1,"MASK"],[59,38,0,51,0,"CONDITIONING"],[60,51,0,20,5,"CONDITIONING"],[67,55,0,20,2,"MODEL"],[68,48,0,58,1,"IMAGE"],[69,53,0,58,0,"IMAGE"],[71,25,0,27,0,"IMAGE"],[72,58,0,25,0,"IMAGE"],[73,58,0,29,1,"IMAGE"],[74,58,0,31,0,"IMAGE"],[75,58,0,20,0,"IMAGE"],[76,35,0,59,0,"MODEL"],[78,59,0,60,0,"MODEL"],[79,60,0,55,0,"MODEL"],[80,20,0,40,0,"IMAGE"],[81,20,0,61,0,"IMAGE"],[83,36,0,62,0,"CLIP"],[84,62,0,38,0,"CLIP"],[85,47,0,63,0,"MASK"],[88,63,0,65,0,"MASK"],[89,65,0,32,0,"MASK"],[91,68,0,25,1,"FL2MODEL"]],"groups":[{"title":"Florence2","bounding":[-10,-40,1200,690],"color":"#444","font_size":24,"flags":{}},{"title":"SAM2","bounding":[1220,150,730,500],"color":"#00dbcd","font_size":24,"flags":{}},{"title":"Model Loader and Prompt","bounding":[390,680,800,870],"color":"#3de600","font_size":24,"flags":{}},{"title":"SEGS Detailer","bounding":[1220,680,1160,970],"color":"#6900d1","font_size":24,"flags":{}},{"title":"Set Manual Mask","bounding":[810,1580,380,710],"color":"#f00074","font_size":24,"flags":{}}],"config":{},"extra":{"ds":{"scale":0.5445000000000005,"offset":[1815.8688059276346,233.40757791014516]}},"version":0.4}